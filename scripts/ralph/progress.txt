## Codebase Patterns
- next-intl v4 uses `requestLocale` (not `locale`) in getRequestConfig - must await it
- Middleware matcher pattern: `'/(vi|en)/:path*'` for locale routes
- Messages JSON files go in `/messages` directory at project root
- Translation keys use nested structure (e.g., `admin.events.title`) - access via `t('admin.events.title')` or `t('title')` with namespace
- Escape quotes in JSX: `&apos;` for apostrophes, `&quot;` for double quotes
- Locale layout uses `await params` pattern (Next.js 15 style): `const { locale } = await params;`
- Root layout remains minimal (html/body only), providers go in locale layout
- SSG: `generateStaticParams` in layout propagates to all child pages - no need to add it to each page
- Server Components use `getTranslations('namespace')` from 'next-intl/server', Client Components use `useTranslations('namespace')`
- useTranslations() returns function directly: `const t = useTranslations()` (not `const { t } = ...`)
- Use `defineRouting()` in src/i18n/routing.ts and `createNavigation(routing)` in src/i18n/navigation.ts for locale-aware navigation
- For locale switching: use `useRouter` from '@/i18n/navigation' with `router.replace(pathname, { locale: nextLocale })`
- next-intl middleware automatically sets NEXT_LOCALE cookie for language persistence

---

## 2026-01-19 - US-001
Thread: https://ampcode.com/threads/T-019bd940-895a-75d9-b57a-d3f53daaeeb6
- Installed next-intl package (v4.7.0)
- Created src/i18n.ts with getRequestConfig for locale handling
- Created src/middleware.ts for locale detection and routing
- Updated next.config.js with next-intl plugin wrapper
- Created /messages/en.json and /messages/vi.json (placeholder content for US-002)
- Added .eslintrc.json with next/core-web-vitals config
- Files changed: package.json, package-lock.json, next.config.js, src/i18n.ts, src/middleware.ts, messages/en.json, messages/vi.json, .eslintrc.json
- **Learnings for future iterations:**
  - next-intl v4 API: use `requestLocale` instead of `locale` in getRequestConfig callback
  - Must await requestLocale before using it
  - Plugin pattern: `withNextIntl(nextConfig)` wraps the config
---

## 2026-01-19 - US-002
Thread: https://ampcode.com/threads/T-019bd942-6d24-7202-8a2e-4874631979cc
- Extracted all 100+ translations from LanguageContext.tsx into JSON files
- Created complete /messages/en.json with nested structure (church, navigation, hero, welcome, ministries, stories, events, contact, footer, admin)
- Created complete /messages/vi.json with matching structure
- Fixed pre-existing ESLint errors (unescaped quotes/apostrophes in JSX)
- Files changed: messages/en.json, messages/vi.json, ContactForm.tsx, Welcome.tsx, ClassesList.tsx, LocationsList.tsx
- **Learnings for future iterations:**
  - Translation keys use nested structure (e.g., `admin.events.title`) not flat dot notation
  - Must escape quotes in JSX: use `&apos;` for apostrophes, `&quot;` for double quotes
---

## 2026-01-19 - US-003
Thread: https://ampcode.com/threads/T-019bd945-6b16-74d2-a25c-8ed71cdba27b
- Created src/app/[locale]/ directory structure
- Moved page.tsx, login/, admin/, blog/, unauthorized/ to [locale]
- Created src/app/[locale]/layout.tsx with NextIntlClientProvider and locale handling
- Updated root layout.tsx to be minimal (no providers - they moved to locale layout)
- Files changed: src/app/layout.tsx, src/app/[locale]/layout.tsx, plus all moved pages
- **Learnings for future iterations:**
  - No privacy page existed (PRD acceptance criteria mentioned it but it wasn't there)
  - Locale layout params use Promise pattern: `params: Promise<{ locale: string }>` and must `await params`
  - NextIntlClientProvider wraps client components for translations to work
---

## 2026-01-19 - US-004
Thread: https://ampcode.com/threads/T-019bd947-c7ee-7077-9d7d-13ba52a04669
- Verified SSG is already working from US-003 implementation
- `generateStaticParams` in [locale]/layout.tsx handles both locales
- Build output shows ‚óè (SSG) for all routes: /en, /vi, /en/admin, etc.
- No code changes needed - functionality was pre-existing
- **Learnings for future iterations:**
  - `export const dynamic = 'force-static'` only works in Server Components, not 'use client' files
  - SSG happens automatically when generateStaticParams is defined in layout
  - Client components can still be SSG - they're pre-rendered and hydrated
---

## 2026-01-19 - US-005
Thread: https://ampcode.com/threads/T-019bd949-ea17-72d6-9177-4883bf9f9e36
- Converted src/app/[locale]/page.tsx to Server Component (removed 'use client' and useLanguage)
- Created src/app/[locale]/privacy/page.tsx as a pure Server Component using `getTranslations`
- Added privacy translations to messages/en.json and messages/vi.json
- Files changed: src/app/[locale]/page.tsx, src/app/[locale]/privacy/page.tsx, messages/en.json, messages/vi.json
- **Learnings for future iterations:**
  - Server Components can render Client Components as children - they don't need translations themselves
  - `getTranslations('namespace')` returns a function that works like `t('key')` for server-side
  - Privacy page shows 204 B size in build output - pure Server Component with minimal JS
---

## 2026-01-19 - US-006
Thread: https://ampcode.com/threads/T-019bd94c-7bcc-706a-8bf3-7d21e1e037be
- Migrated all client components from useLanguage() to useTranslations() from next-intl
- Updated components: Welcome, Header, Footer, Hero, Ministries, Stories, ContactForm
- Updated pages: blog/page.tsx, admin/page.tsx, admin/discipleship/page.tsx
- NextIntlClientProvider was already set up in [locale]/layout.tsx from US-003
- Files changed: 12 component/page files
- **Learnings for future iterations:**
  - `useTranslations()` returns a function directly (not `{ t }` like useLanguage)
  - Can use `useTranslations()` without namespace for dot-notation keys like `t('welcome.title')`
  - Or use `useTranslations('welcome')` then `t('title')` for namespace-scoped access
  - LanguageToggle still uses useLanguage() for language/setLanguage - that's separate from translations
---

## 2026-01-19 - US-007
Thread: https://ampcode.com/threads/T-019bd94e-975d-7719-9059-d905d5de3710
- Created src/i18n/routing.ts with `defineRouting()` for centralized routing config
- Created src/i18n/navigation.ts with `createNavigation(routing)` for locale-aware navigation utilities
- Updated LanguageToggle to use `useRouter` and `usePathname` from navigation.ts
- Toggle now uses `router.replace(pathname, { locale: nextLocale })` for URL-based locale switching
- Updated src/i18n.ts to use routing config and `hasLocale()` helper
- Updated src/middleware.ts to use routing config
- Updated [locale]/layout.tsx to use routing config and `hasLocale()`
- Files changed: src/components/LanguageToggle.tsx, src/i18n.ts, src/i18n/routing.ts, src/i18n/navigation.ts, src/middleware.ts, src/app/[locale]/layout.tsx
- **Learnings for future iterations:**
  - next-intl middleware automatically sets NEXT_LOCALE cookie for locale persistence
  - `createNavigation(routing)` exports Link, redirect, usePathname, useRouter, getPathname
  - For programmatic locale switching: `router.replace(pathname, { locale: nextLocale })`
  - `useLocale()` from next-intl returns current locale in client components
  - Use `useTransition()` for pending state during navigation
---
